# 🚀 功能快速参考指南

## 📋 新增功能使用说明

### 1. 删除级联功能

**当您想删除一篇日记时：**

```
日记列表 → 点击要删除的日记 → 删除按钮
```

**系统会自动：**
- ✅ 删除您本地保存的个人日记
- ✅ 检查是否存在共享版本
- ✅ 如果存在，从 Firebase 删除共享日记
- ✅ 清理本地映射记录

**确认提示文字：**
```
确定删除这篇文章吗？

注意：如果该文章已共享，共享版本也会被删除。
```

---

### 2. "我的共享"管理面板

**如何访问：**

```
日记页面 → 选择"我的共享"标签页
```

**您可以看到：**
- 📝 所有自己创建的共享日记列表
- 📊 每个共享的统计信息：
  - 标题和分类
  - 分享模式（公开/朋友可见）
  - 评论数量
  - 创建日期
  - 内容预览（前100字）

**可执行的操作：**
- 👀 **查看**：查看完整的共享日记和评论
- 🗑️ **删除**：删除不需要的共享
- 📋 **复制码**：复制共享码分享给朋友

**操作流程：**
```
我的共享 → 选择要管理的日记 → 查看/删除
```

---

### 3. 共享模式清晰展示

**在共享广场中：**

每个共享日记卡片上都会显示清晰的标签：

```
🌐 所有人可见  - 绿色标签 - 任何人都能访问
👥 朋友可见    - 蓝色标签 - 需要共享码才能查看
```

---

## 📊 数据流程示意

### 创建并共享日记的完整流程

```
创建个人日记
    ↓
保存到 localStorage (w3_journal)
    ↓
点击分享按钮
    ↓
选择共享模式（公开/朋友可见）
    ↓
输入昵称 → 点击"创建共享"
    ↓
保存到 Firebase (shared_diaries/{sharedId})
    ↓
记录映射关系到 localStorage (w3_shared_records)
    ↓
生成并显示共享码
    ↓
可以复制链接分享给朋友
```

### 删除日记的完整流程

```
选择要删除的日记
    ↓
点击删除按钮 → 确认
    ↓
查询 localStorage 中的映射 (w3_shared_records)
    ↓
如果存在共享版本
    ├─ 从 Firebase 删除 (shared_diaries/{sharedId})
    └─ 从 localStorage 清理映射
    ↓
从本地删除个人日记
    ↓
删除完成！
```

---

## 🔧 技术细节

### localStorage 中的新增键

```javascript
w3_shared_records: {
  "1234567890": "shared_code_123abc",  // articleId: sharedId
  "9876543210": "shared_code_456def",
  ...
}
```

### Firebase 数据结构

```
shared_diaries/
└── {sharedId}/
    ├── article: { title, category, content, author, date, ... }
    ├── creatorId: 1234567890
    ├── shareMode: "public" | "friends"
    └── comments/
        └── {commentId}: { author, content, timestamp, date }
```

---

## ⚠️ 重要提示

### 关于删除

- ⚠️ 删除是**永久性的**，无法撤销
- ⚠️ 删除个人日记会同时删除其共享版本
- ⚠️ 已存在的评论会随共享日记一起删除

### 关于共享码

- 💡 共享码可以复制和保存
- 💡 朋友通过"加入共享"功能输入码来查看
- 💡 不同的共享会生成不同的码

### 关于评论

- 💬 评论会实时同步到 Firebase
- 💬 任何人都可以在共享日记上评论（需要输入昵称）
- 💬 删除共享日记会删除所有相关评论

---

## 🎯 常见操作

### 场景1：我想分享一篇日记给朋友

```
日记列表 → 找到要分享的日记
    ↓
点击分享按钮
    ↓
选择"所有人可见"（朋友无需码）或"朋友可见"（需要码）
    ↓
输入昵称 → 点击"创建共享"
    ↓
复制生成的共享码
    ↓
把链接和码分享给朋友
```

### 场景2：我想查看自己创建了哪些共享

```
日记页面 → 点击"我的共享"标签页
    ↓
查看所有自己创建的共享
    ↓
可以看到每个共享的详细信息和评论数
```

### 场景3：我想删除一个不再需要的共享

```
方案A - 从日记页面删除整篇文章（包括共享）：
日记列表 → 删除按钮 → 确认
    → 文章和共享都会被删除

方案B - 只删除共享，保留个人日记：
我的共享 → 找到共享 → 点击删除按钮
    → 只删除共享版本，个人日记保留
```

### 场景4：朋友要加入我的私密日记

```
朋友获得我的共享码
    ↓
打开系统 → 日记页面
    ↓
点击"创建共享"部分的"加入朋友的日记"
    ↓
粘贴共享码 → 输入昵称
    ↓
点击"加入" → 可以查看和评论
```

---

## 📱 多设备/浏览器注意事项

### localStorage 是本地存储

- ✅ 可以在同一浏览器的不同标签页访问
- ❌ 不能跨浏览器访问（Firefox 和 Chrome 的数据分离）
- ❌ 不能跨设备访问（手机和电脑数据分离）
- ✅ 个人日记数据可以通过"导出"功能导出后在其他设备导入

### Firebase 是云端存储

- ✅ 共享日记可以在任何设备、任何浏览器访问
- ✅ 评论会实时同步到所有在线的人
- ✅ 朋友不需要注册账号就能查看和评论

---

## 🐛 问题排查

### 问题：删除日记后，共享广场里还能看到

**原因**：共享广场是公开数据，删除可能有延迟

**解决**：
1. 刷新页面（Ctrl+R）
2. 等待几秒钟让 Firebase 同步
3. 检查确认删除操作完成

### 问题："我的共享"里看不到刚创建的共享

**原因**：页面缓存或 Firebase 同步延迟

**解决**：
1. 刷新页面
2. 检查浏览器的开发者工具（F12）查看是否有错误
3. 等待 1-2 秒 Firebase 同步

### 问题：无法删除共享日记

**原因**：网络连接问题或权限问题

**解决**：
1. 检查网络连接
2. 确保是自己创建的共享（有 creatorId）
3. 查看浏览器控制台的错误信息

---

## 📞 获取帮助

如遇到问题，请：
1. 检查浏览器控制台（F12）的错误信息
2. 查看本项目的 GitHub Issues
3. 提交 Bug 报告到：https://github.com/lingdang4126-cell/w3-app/issues

---

**更新于**: 2025-01-XX
**版本**: v2.0.2
